<!DOCTYPE html>
<html>
    <head>
        <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon"> 
        <script src="/oboe-browser.js"></script>
    </head>
<body>
    <ul>
        <li><a href='index.html'>index.html</a></li>
        <li><a href='about.html'>about.html</a></li>
        <li><a href='tdd.html'>tdd.html</a></li>
        <li><a href='stream.html'>stream.html</a></li>
     </ul>
<hr/>
<script>

function flatfile() {
    document.getElementById("out").value = ""
    const url  = 'things2.json'
    count = 0 
    oboe(url)
    .node('foods.*', function(x) {
        count++
        document.getElementById("out").value += JSON.stringify(x) + "\n"
    })
    .done(function(data) {
        console.log("All done")
    })    
    .fail(function(why) {
        console.log("It failed\n" + JSON.stringify( why, null, 2 ) )
    })
}


function guiTest() {
    document.getElementById("out").value = ""
    const url  = '/guiTest2'
    count = 0 
    oboe(url)
    .node('!', function(x) {
        count++
        document.getElementById("out").value += JSON.stringify(x) + "\n"
    })
    .done(function(data) {
        console.log("All done")
    })    
    .fail(function(why) {
        console.log("It failed\n" + JSON.stringify( why, null, 2 ) )
    })
}
</script>

<table border='1'>
<tr>
<td valign='top'>
    <button onclick="guiTest();">guiTest ( express ) </button>
    <button onclick="flatfile();">flatfile ( raw json file ) </button>
    
    <hr/>
    <textarea rows='20' cols='50' id='out'></textarea>
</td>
<td valign='top'>
<h5>Example json</h5>
<pre>
    {
        "something": [
            {"name":finch,"data":{"fname":"fname","lname":"lname","sca":"sca","grp":"grp","aor":"aor","request_month":"June","end_month":"April","sNumber":2001,"trNumber":2001,"submitDate":"11/04/2019","assignee":"Jacqueline Cooper","productType":"D64","transactionType":"D64","groupId":8,"wholeSalerCode":"888795","scaReasonCode":"RGA"}},
            {"name":wren,"data":{"fname":"fname","lname":"lname","sca":"sca","grp":"grp","aor":"aor","request_month":"June","end_month":"April","sNumber":2001,"trNumber":2001,"submitDate":"11/04/2019","assignee":"Jacqueline Cooper","productType":"D64","transactionType":"D64","groupId":8,"wholeSalerCode":"888795","scaReasonCode":"RGA"}},
            {"name":swift,"data":{"fname":"fname","lname":"lname","sca":"sca","grp":"grp","aor":"aor","request_month":"June","end_month":"April","sNumber":2001,"trNumber":2001,"submitDate":"11/04/2019","assignee":"Jacqueline Cooper","productType":"D64","transactionType":"D64","groupId":8,"wholeSalerCode":"888795","scaReasonCode":"RGA"}},
        ]
     }
</pre>
<h5>Example client</h5>
<pre>
    function guiTest() {
        document.getElementById("out").value = ""
        const url  = '/guiTest2'
        count = 0 
        oboe(url)
        .node('!', function(x) {
            count++
            document.getElementById("out").value += JSON.stringify(x) + "\n"
        })
        .done(function(data) {
            console.log("All done")
        })    
        .fail(function(why) {
            console.log("It failed\n" + JSON.stringify( why, null, 2 ) )
        })
    }
</pre>
<pre>
    <h5>Example server</h5>
    const guiTest2 = (request, response) => {
        pool.connect(function(err, client, done) {
            if (err) {
                throw err;
            }
            const query = new QueryStream('select info from orders')
            response.write('{"info": [')
            const stream = client.query(query)
            stream.on('end', done)
            stream.on('data', (row) => {
                x = JSON.stringify(row)
                response.write(x);
                console.log(x)
            });      
            response.write("]}")
        })
      }</pre>





</td>
</tr>
</table>

</body>
</html>
